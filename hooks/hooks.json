{
  "hooks": {
    "SessionStart": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "bash -c 'KNOWLEDGE_DIR=\".claude/planning-with-james/knowledge\"; if [ ! -d \"$KNOWLEDGE_DIR\" ]; then echo \"{\\\"message\\\": \\\"Knowledge base not found. Run /planning-with-james:create-knowledge to index this codebase.\\\"}\"; else OVERVIEW=\"$KNOWLEDGE_DIR/_overview.md\"; if [ -f \"$OVERVIEW\" ]; then LAST_COMMIT=$(grep -oP \"(?<=last_commit: )[a-f0-9]+\" \"$OVERVIEW\" 2>/dev/null || echo \"\"); CURRENT_COMMIT=$(git rev-parse HEAD 2>/dev/null || echo \"\"); if [ -n \"$LAST_COMMIT\" ] && [ -n \"$CURRENT_COMMIT\" ] && [ \"$LAST_COMMIT\" != \"$CURRENT_COMMIT\" ]; then COMMIT_COUNT=$(git rev-list --count \"$LAST_COMMIT\"..\"$CURRENT_COMMIT\" 2>/dev/null || echo \"unknown\"); echo \"{\\\"message\\\": \\\"Knowledge base is $COMMIT_COUNT commits behind. Consider running /planning-with-james:update-knowledge.\\\"}\"; fi; fi; fi'",
            "timeout": 10
          }
        ]
      }
    ],
    "PreToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "prompt",
            "command": "bash -c 'REG=\".claude/planning-with-james/plans/_registry.json\"; [ -f \"$REG\" ] || exit 0; ACTIVE=$(jq -r \".active_plan // empty\" \"$REG\" 2>/dev/null); [ -n \"$ACTIVE\" ] || exit 0; PDIR=$(jq -r \".plans[\\\"$ACTIVE\\\"].path // empty\" \"$REG\" 2>/dev/null); [ -n \"$PDIR\" ] && [ -f \"$PDIR/_plan_state.json\" ] || exit 0; TASK=$(jq -r \".current_task // \\\"starting\\\"\" \"$PDIR/_plan_state.json\" 2>/dev/null); DESC=$(jq -r \".current_task_description // empty\" \"$PDIR/_plan_state.json\" 2>/dev/null); if [ -n \"$DESC\" ]; then echo \"[ACTIVE PLAN: $ACTIVE | Task $TASK: $DESC]\"; else echo \"[ACTIVE PLAN: $ACTIVE | Task: $TASK]\"; fi'",
            "timeout": 5
          }
        ]
      }
    ]
  }
}
